<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        input {
            transform: scale(2);
        }

        #img {
            width: 75vw;
            height: 40vh;
            background-position: center;
            background-size: contain;
            background-repeat: no-repeat;
        }
	</style>
    <script>
        const IMAGE_CACHE_COUNT = 5;
        var cachedImages = []
        
        var currentIndex;
        var currentCache;

        var getNewImage = () => {
            return fetch("https://script.google.com/a/koontzs.com/macros/s/AKfycbwxlBGhHPGxNQyg8Gayt7bnbtTdDEnauVz-GafHPq75LIBu7KgO/exec?img=next").then((str) => {
                return str.json();
            }).then((obj) => {
                console.log(obj)
                obj.image = new Image();
                obj.image.src = 'https://drive.google.com/a/koontzs.com/uc?id=' + obj.id + '&export=download';
                cachedImages.push(obj);
            });
        };

        window.onload = () => {
            document.querySelector("#next").addEventListener("click", () => {
                //get the data
                let pictoThing = [...document.querySelectorAll('.radio')].map((elem) => {
                    return [...elem.childNodes].filter((elem) => {
                        return elem.checked;
                    })[0];
                });
                //check the data
                for(let i = 0, len = pictoThing.length; i < len; i++)  
                    if(!pictoThing[i]) 
                        return document.querySelector('#error').innerHTML = "SELECT ALL THE THINGS PLEASE";
                pictoThing = pictoThing.map((p) => { return p.value; }); 
                //push back data
                let out = {
                    glare: pictoThing[0],
                    light: pictoThing[1],
                    print: pictoThing[2],
                    blur: pictoThing[3],
                    balls: pictoThing[4]
                };
                if(pictoThing[5] === "none") out.type = "none";
                console.log(out);
                let url = "https://script.google.com/a/koontzs.com/macros/s/AKfycbwxlBGhHPGxNQyg8Gayt7bnbtTdDEnauVz-GafHPq75LIBu7KgO/exec?index=" + cachedImages[0].index + "&cacheIndex=" + cachedImages[0].cacheIndex + "&data=" + encodeURIComponent(JSON.stringify(out));
                console.log(url);
                fetch(url);
                document.querySelector('#error').innerHTML = "K THXS"; 
                cachedImages.splice(0, 1);
                getNewImage();
                document.querySelector('#img').style.backgroundImage = "url(" + cachedImages[0].image.src + ")";
            });

            var recurse = () => {
                if(cachedImages.length < IMAGE_CACHE_COUNT) return getNewImage().then(recurse);
            }

            recurse().then(() => {
                document.querySelector('#img').style.backgroundImage = "url(" + cachedImages[0].image.src + ")";
            });
        };
	</script>
</head>
<body>
    <div id="img"></div>
    <div id="form">
        <p>Glare</p>
        <div id="glare" class="radio">
            <input type="radio" class="glare" id="glarePaper" name="glare" value="paper">
            <label for="glarePaper">Paper</label>
            <input type="radio" class="glare" id="glarePlatic" name="glare" value="plastic">
            <label for="glarePlatic">Platic</label>
            <input type="radio" class="glare" id="glarePlexi" name="glare" value="plexi">
            <label for="glarePlexi">Plexi</label>
            <input type="radio" class="glare" id="glareFlash" name="glare" value="flashlight">
            <label for="glareFlash">Flashlight</label>
        </div>
        <p>Lighting</p>
        <div id="light" class="radio">
            <input type="radio" class="light" id="lightNone" name="light" value="none">
            <label for="lightNone">None</label>
            <input type="radio" class="lighting" id="lightPoor" name="light" value="poor">
            <label for="lightPoor">Poor</label>
            <input type="radio" class="lighting" id="lightGood" name="light" value="good">
            <label for="lightGood">Good</label>
        </div>
        <p>Print Quality</p>
        <div id="print" class="radio">
            <input type="radio" class="print" id="printGood" name="print" value="good">
            <label for="printGood">Good</label>
            <input type="radio" class="print" id="printBad" name="print" value="bad">
            <label for="printBad">Bad</label>
        </div>
        <p>Bluriness</p>
        <div id="blur" class="radio">
            <input type="radio" class="blur" id="blurNone" name="blur" value="none">
            <label for="blurNone">None</label>
            <input type="radio" class="blur" id="blurYes" name="blur" value="blur">
            <label for="blurYes">Blurred</label>
        </div>
        <p>Balls Present</p>
        <div id="balls" class="radio">
            <input type="radio" class="balls" id="ballsNone" name="balls" value="none">
            <label for="ballsNone">None</label>
            <input type="radio" class="balls" id="ballsRed" name="balls" value="red">
            <label for="ballsRed">Red</label>
            <input type="radio" class="balls" id="ballsBlue" name="balls" value="blue">
            <label for="ballsBlue">Blue</label>
        </div>
        <p>Pictogram Present</p>
        <div id="picto" class="radio">
            <input type="radio" class="picto" id="pictoYes" name="picto" value="yes">
            <label for="pictoYes">Yes</label>
            <input type="radio" class="picto" id="pictoNone" name="picto" value="none">
            <label for="pictoNone">None</label>
        </div>
        <button id="next" type="button">Next</button>
    </div>
    <p id="error"></p>
</body>
</html>